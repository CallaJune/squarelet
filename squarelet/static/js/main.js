function f(b){return document.getElementById(b)}function g(b){return null!=document.getElementById(b)}function l(b,a,d){Array.isArray(a)?a.forEach(function(a){return b.addEventListener(a,d,!1)}):b.addEventListener(a,d,!1)}function fetch(b,a){void 0===a&&(a="GET");return new Promise(function(d,e){var c=new XMLHttpRequest;c.onload=function(){var a=c.status;200<=a&&300>a?d(c.responseText):e(a+": "+c.responseText)};c.open(a,b);c.send()})}function n(b){b.classList.remove("_cls-hide")}
function p(b){b.classList.add("_cls-hide")}
var q=function(){function b(){var a=this;this.filter=f("_id-filter");this.close=f("_id-close");this.results=f("_id-results");this.page=1;this.morePages=!0;this.currentSearch="";this.currentPage=1;this.async=null;l(this.close,"click",function(){a.filter.value="";a.page=1;a.morePages=!0;a.fetch("")});l(this.filter,"input",function(){a.resetAsync();a.page=1;a.morePages=!0;a.fetch(a.filter.value)});l(this.results,"scroll",function(){var d=a.results.scrollTop+a.results.offsetHeight;a.page==a.currentPage&&
d>a.results.scrollHeight-40&&a.nextPage()})}b.prototype.resetAsync=function(){this.async=null};b.prototype.clearResults=function(){for(;this.results.firstChild;)this.results.removeChild(this.results.firstChild)};b.prototype.render=function(a,d,b){void 0===b&&(b="");d||this.clearResults();for(d=0;d<a.length;d++){var c=a[d];this.addResult(c.name,c.slug,c.avatar,b)}this.results.scrollHeight<this.results.offsetHeight+40&&this.nextPage()};b.prototype.addResult=function(a,b,e,c){void 0===c&&(c="");var d=
document.createElement("a");d.href=b;b=document.createElement("div");b.className="_cls-result";var h=document.createElement("div");h.className="_cls-inlineAvatar";var k=document.createElement("img");k.src=e;k.width=22;k.height=22;h.appendChild(k);b.appendChild(h);if(""==c)c=document.createElement("span"),c.textContent=a,b.appendChild(c);else for(e=c.toLowerCase(),h=a.toLowerCase();;)if(k=h.indexOf(e),-1!=k){var m=document.createElement("span");m.textContent=a.substring(0,k);b.appendChild(m);m=document.createElement("b");
m.textContent=a.substr(k,c.length);a=a.substr(k+c.length);h=h.substr(k+c.length);b.appendChild(m)}else{m=document.createElement("span");m.textContent=a;b.appendChild(m);break}d.appendChild(b);this.results.appendChild(d)};b.prototype.fetch=function(a,b){var d=this;void 0===b&&(b=!1);b||(this.results.scrollTop=0);var c=this.page;this.currentSearch=a;this.async=fetch("autocomplete?q="+a+"&page="+c).then(function(e){e=JSON.parse(e);d.currentSearch==a&&d.page==c&&(e=e.data,d.currentPage=c,0==e.length&&
(d.morePages=!1),d.render(e,b,a),d.async=null)})};b.prototype.nextPage=function(){this.morePages&&(this.page++,this.fetch(this.filter.value,!0))};return b}(),r=function(){function b(){var a=this;this.dropdown=f("_id-profDropdown");this.contents=f("_id-dropdownContents");this.shim=f("_id-shim");this.hidden=!0;l(this.dropdown,"click",function(){a.hidden?a.show():a.hide()});l(this.shim,"click",function(){a.hide()})}b.prototype.show=function(){this.hidden=!1;this.dropdown.classList.add("_cls-active");
n(this.contents);n(this.shim)};b.prototype.hide=function(){this.hidden=!0;this.dropdown.classList.remove("_cls-active");p(this.contents);p(this.shim)};return b}();
function t(){var b=this;this.expandActions=Array.from(document.getElementsByClassName("_cls-expandAction"));this.expanded=!1;this.expandActions.forEach(function(a){l(a,"click",function(){if(b.expanded)b.expanded=!1,a.firstChild.textContent="Expand",d=a.closest("._cls-manageRow"),d=d.nextSibling,d.parentElement.removeChild(d);else{b.expanded=!0;a.firstChild.textContent="Collapse";var d=a.closest("._cls-manageRow"),e=document.createElement("div");e.className="_cls-manageRow _cls-iframeRow";var c=document.createElement("iframe");
c.src="/organizations/~charge/"+a.dataset.charge+"/";e.appendChild(c);d.parentElement.insertBefore(e,d.nextSibling)}})})}
var u=window.Stripe,v={base:{color:"#3F3F3F",fontSize:"18px",fontFamily:"system-ui, sans-serif",fontSmoothing:"antialiased","::placeholder":{color:"#899194"}},invalid:{color:"#e5424d",":focus":{color:"#303238"}}},x=function(){function b(){this.stripePk=f("id_stripe_pk");this.planInput=f("id_plan");this.ucofInput=f("id_use_card_on_file");this.ccFieldset=f("_id-cardFieldset");this.planInfoElem=f("_id-planInfo");this.planProjection=f("_id-planProjection");this.cardContainer=f("card-container");this.receiptEmails=
f("_id-receiptEmails");this.totalCost=f("_id-totalCost");this.costBreakdown=f("_id-costBreakdown");this.maxUsersElem=f("id_max_users");this.planInfo=JSON.parse(this.planInfoElem.textContent);this.setupMaxUsersField();this.setupCardOnFileField();this.setupReceiptEmails();this.setupStripe();this.updateAll()}b.prototype.receiptResize=function(){this.receiptEmails.style.height="5px";this.receiptEmails.style.height=this.receiptEmails.scrollHeight+"px"};b.prototype.getPlan=function(){return this.planInfo[this.planInput.value]};
b.prototype.updateTotalCost=function(){var a=this.getPlan();this.totalCost.textContent="$"+(a.base_price+(this.maxUsers-a.minimum_users)*a.price_per_user);var b="$"+a.base_price+" (base price)";0!=this.maxUsers&&(0==this.maxUsers-a.minimum_users?(b+=" with "+a.minimum_users+" user"+(1!=a.minimum_users?"s":"")+" included",0!=a.price_per_user&&(b+=" ($"+a.price_per_user+" per additional user)")):b+=" with "+a.minimum_users+" user"+(1!=a.minimum_users?"s":"")+" included and "+(this.maxUsers-a.minimum_users)+
" extra users at $"+a.price_per_user+" each");this.costBreakdown.textContent=b};b.prototype.updatePlanInput=function(){var a=this.getPlan();a=w(a);this.updateTotalCost();a?(null!=this.ccFieldset&&(this.ccFieldset.style.display="none"),null!=this.planProjection&&(this.planProjection.style.display="none")):(null!=this.ccFieldset&&(this.ccFieldset.style.display=""),null!=this.planProjection&&(this.planProjection.style.display=""));this.updateAll(!1)};b.prototype.updateMaxUsers=function(){if(null!=this.maxUsersElem){this.maxUsers=
parseInt(this.maxUsersElem.value);var a=this.getPlan().minimum_users;this.maxUsersElem.min=""+a;this.maxUsers<a&&(this.maxUsersElem.value=""+a,this.maxUsers=a)}};b.prototype.updateSavedCC=function(){null==this.ucofInput?w(this.getPlan())?null!=this.cardContainer&&(this.cardContainer.style.display="none"):null!=this.cardContainer&&(this.cardContainer.style.display=""):"True"==document.querySelector("input[name=use_card_on_file]:checked").value?null!=this.cardContainer&&(this.cardContainer.style.display=
"none"):null!=this.cardContainer&&(this.cardContainer.style.display="")};b.prototype.updateAll=function(a){void 0===a&&(a=!0);this.updateMaxUsers();this.updateSavedCC();a&&this.updatePlanInput()};b.prototype.setupMaxUsersField=function(){var a=this;if(g("id_max_users")){var b=this.maxUsersElem;this.maxUsers=parseInt(b.value);l(b,"input",function(){a.updateAll()})}else this.maxUsers=this.getPlan().minimum_users};b.prototype.setupCardOnFileField=function(){var a=this;g("id_use_card_on_file")&&l(this.ucofInput,
"input",function(){a.updateAll()})};b.prototype.setupReceiptEmails=function(){var a=this;null!=this.receiptEmails&&(this.receiptEmails.rows=2,l(this.receiptEmails,"input",function(){return a.receiptResize()}),this.receiptResize())};b.prototype.setupStripe=function(){var a=this;if(g("card-element")){var b=u(this.stripePk.value),e=b.elements().create("card",{style:v});e.mount("#card-element");e.addEventListener("change",function(a){document.getElementById("card-errors").textContent=a.error?a.error.message:
""});document.getElementById("id_stripe_token").value="";this.planInput.addEventListener("input",function(){a.updateAll()});document.getElementById("stripe-form").addEventListener("submit",function(d){var c=document.querySelector("input[name=use_card_on_file]:checked");c=null!=c&&"True"==c.value;var h=a.getPlan();h=w(h);c||h||(d.preventDefault(),b.createToken(e).then(function(a){a.error?document.getElementById("card-errors").textContent=a.error.message:(a=a.token,document.getElementById("id_stripe_token").value=
a.id,document.getElementById("stripe-form").submit())}))})}};return b}();function w(b){return 0==b.base_price&&0==b.price_per_user}
var y=function(){function b(){var a=this;this.shim=f("_id-shim");this.selects=Array.from(document.getElementsByClassName("_cls-roleSelect"));this.dropdowns=this.selects.map(function(a){return a.nextElementSibling});this.hideAction=null;this.selects.forEach(function(b,e){var c=a.dropdowns[e];l(b,"click",function(){n(c);n(a.shim);a.hideAction=function(){p(c);p(a.shim)}});l(c.querySelector("._cls-selected"),"click",function(){a.hide()})});l(this.shim,"click",function(){a.hide()})}b.prototype.hide=function(){null!=
this.hideAction&&(this.hideAction(),this.hideAction=null)};return b}();g("_id-profDropdown")&&new r;g("_id-autocomplete")&&new q;g("_id-manageTable")&&new y;g("_id-resendVerification");g("_id-receiptsTable")&&new t;g("id_stripe_pk")&&new x;
//# sourceMappingURL=main.js.map
